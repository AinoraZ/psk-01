<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lt.vu.mybatis.dao.PersonMapper">
  <resultMap id="BaseResultMap" type="lt.vu.mybatis.model.Person">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 14 11:10:38 EEST 2020.
    -->
    <id column="ID" jdbcType="INTEGER" property="id" />
    <result column="EMAIL" jdbcType="VARCHAR" property="email" />
    <result column="NAME" jdbcType="VARCHAR" property="name" />
    <result column="SURNAME" jdbcType="VARCHAR" property="surname" />

    <association property="corona" javaType="CoronaCase">
      <id column="corona_id" jdbcType="INTEGER" property="id" />
      <result column="corona_person_id" jdbcType="INTEGER" property="personId" />
      <result column="corona_date_discovered" jdbcType="TIMESTAMP" property="dateDiscovered" />
    </association>

    <collection property="locations" ofType="PersonLocation">
      <id column="person_location_id" jdbcType="INTEGER" property="id" />
      <result column="person_location_date_visited" jdbcType="TIMESTAMP" property="dateVisited" />
      <result column="person_location_location_id" jdbcType="INTEGER" property="locationId" />
      <result column="person_location_person_id" jdbcType="INTEGER" property="personId" />

      <association property="location" javaType="Location">
        <id column="location_id" jdbcType="INTEGER" property="id" />
        <result column="location_latitude" jdbcType="DECIMAL" property="latitude" />
        <result column="location_longitude" jdbcType="DECIMAL" property="longitude" />
        <result column="location_name" jdbcType="VARCHAR" property="name" />
        <result column="location_street" jdbcType="VARCHAR" property="street" />
        <result column="location_cityId" jdbcType="INTEGER" property="cityId" />

        <association property="city" javaType="City">
          <id column="city_id" jdbcType="INTEGER" property="id" />
          <result column="city_country" jdbcType="VARCHAR" property="country" />
          <result column="city_name" jdbcType="VARCHAR" property="name" />
        </association>
      </association>
    </collection>

<!--    <association property="corona" select="getCorona" column="id" javaType="CoronaCase"/>-->
<!--    <collection property="locations" select="selectLocationsForPerson" column="id" javaType="ArrayList" ofType="Location"/>-->
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 14 11:10:38 EEST 2020.
    -->
    delete from PUBLIC.PERSON
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="ID" keyProperty="id" parameterType="lt.vu.mybatis.model.Person" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 14 11:10:38 EEST 2020.
    -->
    insert into PUBLIC.PERSON (EMAIL, NAME, SURNAME
      )
    values (#{email,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{surname,jdbcType=VARCHAR}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="lt.vu.mybatis.model.Person">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 14 11:10:38 EEST 2020.
    -->
    update PUBLIC.PERSON
    set EMAIL = #{email,jdbcType=VARCHAR},
      NAME = #{name,jdbcType=VARCHAR},
      SURNAME = #{surname,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 14 11:10:38 EEST 2020.
    -->
    SELECT
      p.id as id,
      p.email as email,
      p.name as name,
      p.surname as surname,
      c.id as corona_id,
      c.person_id as corona_person_id,
      c.date_discovered as corona_date_discovered,
      pl.id as person_location_id,
      pl.date_visited as person_location_date_visited,
      pl.location_id as person_location_location_id,
      pl.person_id as person_location_person_id,
      l.id as location_id,
      l.latitude as location_latitude,
      l.longitude as location_longitude,
      l.name as location_name,
      l.street as location_street,
      l.city_id as location_city_id,
      ci.id as city_id,
      ci.country as city_country,
      ci.name as city_name
        FROM PUBLIC.PERSON_LOCATION pl
        JOIN PUBLIC.PERSON p on p.id = pl.person_id
        JOIN PUBLIC.LOCATION l on l.id = pl.location_id
        JOIN PUBLIC.CORONA_CASE c on c.person_id = p.id
        JOIN PUBLIC.CITY ci on ci.id = l.city_id
            WHERE p.id = #{id,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 14 11:10:38 EEST 2020.
    -->
    SELECT
      p.id as id,
      p.email as email,
      p.name as name,
      p.surname as surname,
      c.id as corona_id,
      c.person_id as corona_person_id,
      c.date_discovered as corona_date_discovered,
      pl.id as person_location_id,
      pl.date_visited as person_location_date_visited,
      pl.location_id as person_location_location_id,
      pl.person_id as person_location_person_id,
      l.id as location_id,
      l.latitude as location_latitude,
      l.longitude as location_longitude,
      l.name as location_name,
      l.street as location_street,
      l.city_id as location_city_id,
      ci.id as city_id,
      ci.country as city_country,
      ci.name as city_name
          FROM PUBLIC.PERSON_LOCATION pl
          JOIN PUBLIC.PERSON p on p.id = pl.person_id
          JOIN PUBLIC.LOCATION l on l.id = pl.location_id
          JOIN PUBLIC.CORONA_CASE c on c.person_id = p.id
          JOIN PUBLIC.CITY ci on ci.id = l.city_id
  </select>
</mapper>